(()=>{var t={n:a=>{var o=a&&a.__esModule?()=>a.default:()=>a;return t.d(o,{a:o}),o},d:(a,o)=>{for(var s in o)t.o(o,s)&&!t.o(a,s)&&Object.defineProperty(a,s,{enumerable:!0,get:o[s]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},a={};(()=>{"use strict";t.r(a),t.d(a,{default:()=>K});const o=flarum.core.compat["common/extend"],s=flarum.core.compat["forum/components/IndexPage"];var e=t.n(s);const r=flarum.core.compat["common/components/LinkButton"];var n=t.n(r);const i=flarum.core.compat["common/Model"];var c=t.n(i);const l=flarum.core.compat["tags/models/Tag"];var u=t.n(l);function p(t,a){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,a){return t.__proto__=a,t},p(t,a)}function g(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,p(t,a)}const d=flarum.core.compat["common/components/Page"];var f=t.n(d);const h=flarum.core.compat["common/components/LoadingIndicator"];var v=t.n(h);const C=flarum.core.compat["forum/components/AffixedSidebar"];var y=t.n(C);const b=flarum.core.compat["common/helpers/listItems"];var T=t.n(b);const w=flarum.core.compat["tags/utils/sortTags"];var k=t.n(w);const P=flarum.core.compat["tags/helpers/tagLabel"];var D=t.n(P);const L=flarum.core.compat["common/Component"];var I=t.n(L);const _=flarum.core.compat["common/components/Link"];var N=t.n(_);const x=flarum.core.compat["common/helpers/icon"];var M=t.n(x);const S=flarum.core.compat["common/utils/ItemList"];var A=t.n(S),O=function(t){function a(){return t.apply(this,arguments)||this}return g(a,t),a.prototype.view=function(){var t=app.forum.attribute("categories.compactMobile")&&window.innerWidth<767;return m("div",{class:"StatWidget"},m("div",{class:"StatWidget-count"},this.attrs.count),m("div",{class:"StatWidget-label"},t?M()(this.attrs.icon):this.attrs.label))},a}(I());const j=flarum.core.compat["common/helpers/avatar"];var U=t.n(j);const W=flarum.core.compat["common/helpers/username"];var B=t.n(W);const R=flarum.core.compat["common/helpers/humanTime"];var V=t.n(R);const z=flarum.core.compat["common/utils/string"],E=flarum.core.compat["forum/components/UserCard"];var q=t.n(E),F=function(t){function a(){return t.apply(this,arguments)||this}g(a,t);var o=a.prototype;return o.oninit=function(a){t.prototype.oninit.call(this,a),this.cardVisible=!1},o.view=function(){var t=this.attrs.discussion;if(!t)return m("div",{class:"LastDiscussion"},app.translator.trans("askvortsov-categories.forum.last_discussion_widget.no_discussions"));var a=t.lastPostedUser(),o="";return a&&this.cardVisible&&(o=q().component({user:a,className:"UserCard--popover",controlsButtonClassName:"Button Button--icon Button--flat"})),m(N(),{class:"LastDiscussion",href:app.route.discussion(t,t.lastPostNumber())},m(N(),{className:"LastDiscussion-avatar",href:a?app.route.user(a):"#"},U()(a)),m("div",{class:"LastDiscussion-content"},m("div",{class:"LastDiscussion-bottomRow"},V()(t.lastPostedAt())," ",m(N(),{className:"LastDiscussion-usernameLink",href:a?app.route.user(a):"#"}," ","| ",B()(a))),m("div",{class:"LastDiscussion-topRow"},(0,z.truncate)(t.title(),26))),m("div",{class:"LastDiscussion-userCardContainer"},o))},o.oncreate=function(a){var o,s=this;t.prototype.oncreate.call(this,a),this.$().on("mouseover",".LastDiscussion-avatar, .LastDiscussion-usernameLinkUserCard, .username, .UserCard",(function(){clearTimeout(o),o=setTimeout(s.showCard.bind(s),300)})).on("mouseout",".LastDiscussion-avatar, .LastDiscussion-usernameLinkUserCard, .username, .UserCard",(function(){clearTimeout(o),o=setTimeout(s.hideCard.bind(s),150)}))},o.showCard=function(){var t=this;this.cardVisible=!0,m.redraw(),setTimeout((function(){return t.$(".UserCard").addClass("in")}))},o.hideCard=function(){$(".UserCard").removeClass("in"),this.cardVisible=!1,m.redraw()},a}(I()),G=function(t){function a(){return t.apply(this,arguments)||this}g(a,t);var o=a.prototype;return o.oninit=function(a){t.prototype.oninit.call(this,a),this.tag=this.attrs.model,this.isChild=null!=this.attrs.parent&&null!=this.attrs.parent,this.collapsed=!1,window.addEventListener("resize",(function(){m.redraw()}))},o.view=function(){var t=this,o=this.tag;if(!o)return"";this.compactMobileMode=window.innerWidth<=767&&app.forum.attribute("categories.compactMobile");var s=this.isChild?[]:k()(o.children()||[]),e=this.isChild?{}:{backgroundColor:o.color()},r=["TagCategory","TagCategory-"+o.slug()];this.isChild?r.push("SubCategory"):r.push("ParentCategory"),this.compactMobileMode&&r.push("compactMobile");var n=(o.lastPostedDiscussion()?["TagCategory-lastDiscussion"]:["TagCategory-lastDiscussion empty"]).join(" "),i=!this.isChild&&this.compactMobileMode,c=m("ol",{className:"TagCategory-subTagList"},s.map((function(o){return[a.component({model:o,parent:t})]})));return m("li",{class:r.join(" ")},m(N(),{class:"TagCategory-content TagCategory-content-"+o.slug(),style:e,href:app.route.tag(o)},m("div",{class:"TagCategory-alignStart"},m("div",{class:"TagCategory-alignStart-main"},m("span",{class:"TagCategory-icon"},this.iconItems().toArray()),m("div",{class:"TagCategory-main"},this.mainItems().toArray())),0==s.length?"":m("p",{class:"TagCategory-toggleArrow",onclick:function(a){t.toggleArrow(a)}},M()(this.collapsed?"fas fa-caret-down":"fas fa-caret-up"))),m("div",{class:"TagCategory-alignEnd"},m("div",{class:"TagCategory-stats StatWidgetList"},this.statItems().toArray()),m("div",{class:n},this.lastDiscussionItems().toArray())),i&&!this.collapsed?c:""),i||this.isChild?"":c)},o.iconItems=function(){var t=new(A());if(this.tag.icon()&&this.isChild){var a={},o="fa-stack-1x CategoryIcon";app.forum.attribute("categories.childBareIcon")&&(a.color=this.tag.color(),o+=" NoBackgroundCategoryIcon");var s=this.compactMobileMode?"fa-stack fa-1x":"fa-stack fa-2x";t.add("icon",m("span",{class:s},app.forum.attribute("categories.childBareIcon")?"":m("i",{class:"fa fa-circle fa-stack-2x icon-background",style:{color:this.tag.color()}}),M()(this.tag.icon(),{className:o,style:a})),10)}else if(this.tag.icon()&&!app.forum.attribute("categories.parentRemoveIcon")){var e=this.compactMobileMode?"fa-stack fa-2x":"fa-stack fa-3x";t.add("icon",m("span",{class:e},M()(this.tag.icon(),{className:"fa-stack-1x CategoryIcon"})),10)}return t},o.mainItems=function(){var t=new(A());return t.add("name",m("h4",{class:"TagCategory-name"},this.tag.name()),15),!this.tag.description()||!this.isChild&&app.forum.attribute("categories.parentRemoveDescription")||t.add("description",m("div",{class:"TagCategory-description"},this.tag.description()),10),t},o.statItems=function(){var t=new(A());return!this.isChild&&app.forum.attribute("categories.parentRemoveStats")||(t.add("discussionCount",O.component({count:this.tag.discussionCount(),label:app.translator.trans("askvortsov-categories.forum.stat-widgets.discussion_label"),icon:"fas fa-file-alt"}),15),t.add("postCount",O.component({count:this.tag.postCount(),label:app.translator.trans("askvortsov-categories.forum.stat-widgets.post_label"),icon:"fas fa-comment"}),10)),t},o.lastDiscussionItems=function(){var t=new(A());return!this.isChild&&app.forum.attribute("categories.parentRemoveLastDiscussion")||t.add("lastDiscussion",F.component({discussion:this.tag.lastPostedDiscussion()}),10),t},o.oncreate=function(a){t.prototype.oncreate.call(this,a),this.$(".TagCategory-content,.TagCategory-toggleArrow").bind("mouseenter",(function(t){$(this).addClass("hover"),($(this).parent().hasClass("SubCategory")||$(this).hasClass("TagCategory-toggleArrow"))&&$(this).closest(".ParentCategory").children(".TagCategory-content").removeClass("hover")})),this.$(".TagCategory-content,.TagCategory-toggleArrow").bind("mouseleave",(function(t){$(this).removeClass("hover"),($(this).parent().hasClass("SubCategory")||$(this).hasClass("TagCategory-toggleArrow"))&&$(this).closest(".ParentCategory").children(".TagCategory-content").addClass("hover")}))},o.toggleArrow=function(t){t.preventDefault(),t.stopPropagation(),this.collapsed=!this.collapsed,m.redraw()},a}(I()),H=function(t){function a(){return t.apply(this,arguments)||this}g(a,t);var o=a.prototype;return o.oninit=function(a){var o=this;t.prototype.oninit.call(this,a),app.history.push("categories",app.translator.trans("askvortsov-category.forum.header.back_to_categories_tooltip")),this.tags=[];var s=app.preloadedApiDocument();s?this.tags=k()(s.filter((function(t){return!t.isChild()}))):(this.loading=!0,app.tagList.load(["parent","children","lastPostedDiscussion","lastPostedDiscussion.lastPostedUser"]).then((function(){o.tags=k()(app.store.all("tags").filter((function(t){return!t.isChild()}))),o.loading=!1,m.redraw()})))},o.view=function(){if(this.loading)return m(v(),null);var t=this.tags.filter((function(t){return null!==t.position()})),a=this.tags.filter((function(t){return null===t.position()})),o=app.forum.attribute("categories.fullPageDesktop")?["CategoriesPage","TagsPage"]:["CategoriesPage"];return m("div",{className:o.join(" ")},e().prototype.hero(),m("div",{className:"container"},m("div",{className:app.forum.attribute("categories.fullPageDesktop")?"":"sideNavContainer"},m(y(),null,m("nav",{className:"CategoriesPage-nav TagsPage-nav IndexPage-nav sideNav"},m("ul",null,T()(e().prototype.sidebarItems().toArray())))),m("div",{className:"CategoriesPage-content sideNavOffset"},m("ol",{className:"TagCategoryList"},t.map((function(t){return G.component({model:t})}))),a.length?m("div",{className:"TagCloud"},a.map((function(t){return[D()(t,{link:!0})," "]}))):""))))},o.oncreate=function(a){t.prototype.oncreate.call(this,a),app.setTitle(app.translator.trans("askvortsov-categories.forum.all_categories.meta_title_text"))},a}(f());function J(t,a){if(app.current.matches(H)&&app.forum.attribute("categories.fullPageDesktop"))for(var o in t.items)a(o)&&t.remove(o)}app.initializers.add("askvortsov/flarum-categories",(function(){app.routes.categories={path:"/categories",component:H},u().prototype.postCount=c().attribute("postCount"),(0,o.extend)(e().prototype,"navItems",(function(t){return t.has("tags")&&!app.forum.attribute("categories.keepTagsNav")&&t.remove("tags"),t.add("categories",m(n(),{icon:"fas fa-th-list",href:app.route("categories")},app.translator.trans("askvortsov-categories.forum.index.categories_link")),-9.5),t.has("moreTags")&&t.replace("moreTags",m(n(),{href:app.route("categories")},app.translator.trans("flarum-tags.forum.index.more_link"))),J(t,(function(t){return t.startsWith("tag")})),t})),(0,o.extend)(e().prototype,"sidebarItems",(function(t){return J(t,(function(t){return"newDiscussion"!==t&&"nav"!==t})),t}))}));const K={"components/CategoriesPage":H,"components/Category":G,"components/LastDiscussionWidget":F,"components/StatWidget":O}})(),module.exports=a})();
//# sourceMappingURL=forum.js.map